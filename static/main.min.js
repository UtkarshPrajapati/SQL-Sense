const e=document.getElementById("chat-history"),t=document.getElementById("message-input"),n=document.getElementById("chat-form"),s=document.getElementById("send-button"),a=(document.getElementById("send-icon"),document.getElementById("send-spinner"),document.getElementById("schema-display")),i=document.getElementById("schema-content"),o=document.getElementById("schema-toggle-btn"),c=document.getElementById("refresh-schema-btn"),r=document.getElementById("config-toggle-btn"),l=document.getElementById("config-popup"),d=document.getElementById("close-config-btn"),m=(document.getElementById("config-form"),document.getElementById("new-chat-btn")),u=(document.getElementById("main-content-wrapper"),document.getElementById("chat-area")),p=document.getElementById("dark-mode-toggle-btn"),h=document.getElementById("dark-mode-icon-container"),g=(document.getElementById("input-wrapper"),document.getElementById("run-command-tag")),y=document.getElementById("remove-run-tag-btn"),f=document.getElementById("slash-command-popup");let v=!1,L=!0;function E(e){return"string"!=typeof e?e:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function b(e){const t=marked.parse(e);return DOMPurify.sanitize(t)}function x(e="w-5 h-5 text-white"){return`\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="${e}"><g stroke="currentColor"><circle cx="12" cy="12" r="9.5" fill="none" stroke-linecap="round" stroke-width="3"><animate attributeName="stroke-dasharray" calcMode="spline" dur="1.5s" keySplines="0.42,0,0.58,1;0.42,0,0.58,1;0.42,0,0.58,1" keyTimes="0;0.475;0.95;1" repeatCount="indefinite" values="0 150;42 150;42 150;42 150"/><animate attributeName="stroke-dashoffset" calcMode="spline" dur="1.5s" keySplines="0.42,0,0.58,1;0.42,0,0.58,1;0.42,0,0.58,1" keyTimes="0;0.475;0.95;1" repeatCount="indefinite" values="0;-16;-59;-59"/></circle><animateTransform attributeName="transform" dur="2s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></g></svg>\n        <span class="sr-only">Loading...</span>\n    `}function w(n,s,a="info"){const i=document.createElement("div");let o;o="user"===n?"ml-auto":"mr-auto",i.className=`p-3 rounded-lg max-w-3xl ${o} prose prose-sm max-w-none`,i.innerHTML=s,"assistant"===n&&i.querySelectorAll("pre code.language-sql").forEach(e=>{const n=e.parentElement;if(!n)return;const s=e.textContent.trim();if(s){const e=document.createElement("div");e.className="relative";const a=document.createElement("button");a.className="run-query-btn",a.innerHTML='<i data-lucide="play" class="h-3 w-3 inline-block mr-1 -ml-1"></i> Run Query',a.addEventListener("mouseover",()=>a.style.backgroundColor="var(--md-primary-color)"),a.addEventListener("mouseout",()=>a.style.backgroundColor="var(--md-accent-color)"),a.addEventListener("click",()=>{B(),t.value=s.replace(/\n/g," "),t.focus()});const i=document.createElement("button");i.className="copy-query-btn",i.innerHTML='<i data-lucide="copy" class="h-3 w-3 inline-block mr-1 -ml-1"></i> Copy',i.addEventListener("click",()=>{try{navigator.clipboard.writeText(s),H("Query copied to clipboard!","success",2e3)}catch(e){H("Failed to copy query","error",3e3)}}),n.parentNode&&n.parentNode.replaceChild(e,n),e.appendChild(n),e.appendChild(a),e.appendChild(i)}}),e.appendChild(i),j()&&P(),"assistant"===n&&lucide.createIcons(),window.Prism&&"function"==typeof Prism.highlightAllUnder&&Prism.highlightAllUnder(i)}function I(e,t){if(!t||0===t.length)return'<p class="text-sm text-gray-600 italic">Query returned no results.</p>';if(!e||0===e.length)return'<p class="text-sm text-red-600">Error: Missing column names for results.</p>';let n='<div class="results-table"><table><thead><tr>';return e.forEach(e=>{n+=`<th>${E(e)}</th>`}),n+="</tr></thead><tbody>",t.forEach(t=>{n+="<tr>",Array.isArray(t)||t instanceof Object&&"function"==typeof t[Symbol.iterator]?t.length!==e.length?n+=`<td colspan="${e.length}" class="text-red-500 italic">Data format error: row length mismatch</td>`:t.forEach(e=>{n+=`<td>${E((e??"NULL")+"")}</td>`}):n+=`<td colspan="${e.length}" class="text-red-500 italic">Data format error: unexpected row type</td>`,n+="</tr>"}),n+="</tbody></table></div>",100===t.length&&(n+='<p class="text-xs text-gray-500 italic mt-1">Displaying up to 100 rows. The actual result set may be larger.</p>'),n}function T(e){const n=document.getElementById("send-icon"),a=document.getElementById("send-spinner");e?(L||(t.disabled=!0),s.disabled=!0,n.classList.add("icon-fade-out"),setTimeout(()=>{n.classList.add("hidden"),n.classList.remove("icon-fade-out"),a.classList.remove("hidden"),a.classList.add("icon-fade-in"),a.innerHTML=x()},150)):(t.disabled=!1,s.disabled=!1,a.classList.add("icon-fade-out"),setTimeout(()=>{a.classList.add("hidden"),a.classList.remove("icon-fade-out"),a.innerHTML="",n.classList.remove("hidden"),n.classList.remove("icon-fade-out"),n.classList.add("icon-fade-in"),setTimeout(()=>{n.classList.remove("icon-fade-in")},150)},150),window.innerWidth>768&&t.focus({preventScroll:!0}))}async function k(e=!0){let t=0;e&&(i.innerHTML='<div class="flex items-center justify-center p-4"><span class="mr-2">Loading schema...</span>'+x("w-4 h-4 text-blue-600")+"</div>",t=Date.now());const n=(e,t)=>{i.innerHTML=e,lucide.createIcons();const n=i.querySelectorAll(".schema-item");t?requestAnimationFrame(()=>{n.forEach((e,t)=>{setTimeout(()=>{e.classList.add("visible-item")},0+5*t)})}):requestAnimationFrame(()=>{n.forEach(e=>{e.classList.add("visible-item")})})},s=s=>{if(e){const e=Date.now()-t;setTimeout(()=>{n(s,!0)},Math.max(0,500-e))}else n(s,!1)};try{const e=await fetch("/schema");if(!e.ok){let t="HTTP error! status: "+e.status;try{const n=await e.json();t=n.detail||(n.error&&n.error.schema&&Array.isArray(n.error.schema)?n.error.schema.join(", "):t)}catch(e){}throw Error(t)}const t=(await e.json()).schema;let n="";if(t&&"object"==typeof t&&t.error&&t.error.schema&&Array.isArray(t.error.schema))n=`<div class="p-4"><p class="text-red-600">Error fetching schema: ${E(t.error.schema.join(", "))}</p></div>`;else if(t&&"object"==typeof t&&Object.keys(t).length>0){let e="";for(const n in t)if(t.hasOwnProperty(n)){e+=`<div class="schema-item schema-database-item group"><i data-lucide="database"></i>${E(n)}<i data-lucide="chevron-down" class="toggle-icon h-4 w-4 text-gray-400 group-hover:text-gray-600"></i></div>`,e+='<div class="database-content-wrapper">';const s=t[n];if("object"==typeof s&&null!==s&&s.error&&Array.isArray(s.error))e+=`<div class="schema-item schema-table-item italic text-red-500"><i data-lucide="alert-triangle"></i>Error: ${E(s.error.join(", "))}</div>`;else if("object"!=typeof s||null===s||s.error)e+='<div class="schema-item schema-table-item italic"><i data-lucide="info"></i>No table data.</div>';else if(Object.keys(s).length>0)for(const t in s)s.hasOwnProperty(t)&&Array.isArray(s[t])&&(e+=`<div class="schema-item schema-table-item group"><i data-lucide="table-2"></i><strong>${E(t)}</strong><i data-lucide="chevron-down" class="toggle-icon h-4 w-4 text-gray-400 group-hover:text-gray-600"></i></div>`,s[t].length>0?(e+='<div class="schema-columns-list">',s[t].forEach(t=>{e+=`<div class="schema-column">${E(t)}</div>`}),e+="</div>"):e+='<div class="schema-columns-list italic">No columns found.</div>');else e+='<div class="schema-item schema-table-item italic"><i data-lucide="info"></i>No tables found.</div>';e+="</div>"}n=e||'<div class="p-4 text-gray-500"><i data-lucide="search-x" class="inline-block mr-2"></i>No databases or tables found.</div>'}else n='<div class="p-4 text-gray-500"><i data-lucide="database-zap" class="inline-block mr-2"></i>No schema found or unable to fetch.</div>';s(n)}catch(e){s(`<div class="p-4 text-red-600"><i data-lucide="alert-circle" class="inline-block mr-2"></i>Failed to load schema. ${E(e.message)}</div>`)}}function H(e,t="info",n=5e3){const s=document.getElementById("toast-container");if(!s)return;const a=document.createElement("div");a.className="toast toast-"+t;const i=document.createElement("div");i.className="toast-content",i.textContent=e;const o=document.createElement("button");o.className="toast-close",o.innerHTML='<i data-lucide="x" class="h-4 w-4"></i>',o.onclick=()=>{a.classList.add("toast-remove"),a.addEventListener("animationend",()=>{s.contains(a)&&s.removeChild(a)})},a.appendChild(i),a.appendChild(o),s.appendChild(a),lucide.createIcons(),setTimeout(()=>{s.contains(a)&&!a.classList.contains("toast-remove")&&(a.classList.add("toast-remove"),a.addEventListener("animationend",()=>{s.contains(a)&&s.removeChild(a)}))},n)}async function q(){try{const e=await fetch("/config_status");if(!e.ok)throw Error("Server responded with status: "+e.status);const t=await e.json();document.getElementById("mysql-host").value=t.mysql_host||"",document.getElementById("mysql-user").value=t.mysql_user||"";const n=document.getElementById("mysql-password"),s=document.querySelector('label[for="mysql-password"]');t.mysql_password_set?(n.value="",n.placeholder=" ",s.textContent="MySQL Password (already set)"):(n.value="",n.placeholder=" ",s.textContent="MySQL Password");const a=document.getElementById("gemini-api-key"),i=document.querySelector('label[for="gemini-api-key"]');t.gemini_api_key_set?(a.value="",a.placeholder=" ",i.textContent="Gemini API Key (already set)"):(a.value="",a.placeholder=" ",i.textContent="Gemini API Key")}catch(e){H("Could not fetch server configuration: "+e.message,"error")}}function B(){g.classList.remove("hidden"),t.placeholder="Enter SQL query (e.g., SELECT * FROM users)",v=!0,t.value="",M(),t.focus()}function C(){g.classList.add("hidden"),t.placeholder="Type your message or /run command...",v=!1,t.focus()}function M(){f.classList.add("hidden"),f.innerHTML=""}function S(e,t){const n=document.getElementById(e);n&&(n.addEventListener("focus",function(){const n=document.querySelector(`label[for="${e}"]`);n&&n.textContent.includes("(already set)")&&(this.placeholder=t)}),n.addEventListener("blur",function(){this.placeholder=" "}))}function N(e){if(!document.documentElement.classList.contains("dark"))return;const t=e.currentTarget,n=document.createElement("span"),s=Math.max(t.clientWidth,t.clientHeight),a=s/2,i=t.getBoundingClientRect();n.style.width=n.style.height=s+"px",n.style.left=e.clientX-i.left-a+"px",n.style.top=e.clientY-i.top-a+"px",n.classList.add("ripple");const o=t.querySelector(".ripple");o&&o.remove(),t.appendChild(n),n.addEventListener("animationend",()=>{n.parentElement&&n.remove()})}function $(){const e=document.getElementById("greeting");if(!e)return;const t=(new Date).getHours();let n="Good Evening";t>=5&&t<12?n="Good Morning":t>=12&&t<16&&(n="Good Afternoon"),e.textContent=n}function j(t=20){return e.scrollHeight-e.scrollTop-e.clientHeight<t}function P(t=!1){const n=e.scrollHeight-e.scrollTop-e.clientHeight,s=t||n<200;e&&"function"==typeof e.scrollTo?e.scrollTo({top:e.scrollHeight,behavior:s?"smooth":"auto"}):e.scrollTop=e.scrollHeight}document.getElementById("terminal-btn").addEventListener("click",()=>{L&&(u.classList.remove("initial-state"),L=!1),B()}),n.addEventListener("submit",n=>{n.preventDefault();const s=t.value.trim();let a;if(L){if(!s)return;u.classList.remove("initial-state"),L=!1}if(v){if(!s)return H("Please enter an SQL query to run.","warning",3e3),void t.focus();a="/run "+s}else a=s;a&&(async function(n){w("user",`<p>${E(n)}</p>`),t.value="",T(!0);try{const t=await fetch("/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n})});if(!t.ok){let e="HTTP error! status: "+t.status;try{const n=await t.json();e=n.detail||n.content||e}catch(e){}throw Error(e)}const s=await t.json();let a="";if("result"===s.type)a+=`<p class="font-semibold">Generated SQL:</p><pre><code class="language-sql">${E(s.query||"")}</code></pre>`,a+=I(s.columns,s.results),s.insights&&(a+=b(s.insights));else if("info"===s.type)a+=b(s.content);else if("error"===s.type)a+=b(s.content),s.ai_explanation&&(a+=b(s.ai_explanation));else{if("confirm_execution"===s.type)return void function(t,n){const s=document.createElement("div");s.className="p-3 rounded-lg max-w-3xl mr-auto prose prose-sm max-w-none shadow";let a=`<p class="font-semibold">${E(t)}</p>`;a+=`<pre class="p-2 rounded mt-2"><code class="language-sql">${E(n)}</code></pre>`,a+=`<div class="mt-3 flex space-x-2">\n                        <button class="confirm-execute-btn font-semibold py-1.5 px-4 rounded text-sm shadow-sm transition-colors duration-150" data-query="${E(n)}">Execute</button>\n                        <button class="cancel-execute-btn font-semibold py-1.5 px-4 rounded text-sm shadow-sm transition-colors duration-150">Cancel</button>\n                     </div>`,s.innerHTML=a,e.appendChild(s);const i=s.querySelector(".confirm-execute-btn"),o=s.querySelector(".cancel-execute-btn");i&&i.addEventListener("click",async function(){const e=this.dataset.query,t=this.closest(".p-3.rounded-lg");t&&(t.innerHTML=`<p class="font-semibold text-blue-700">Executing query:</p><pre class="bg-blue-50 p-2 rounded mt-2 border border-blue-200"><code class="language-sql text-blue-900">${E(e)}</code></pre><p class="mt-2 text-sm text-gray-600 italic">Please wait...</p>`),j()&&P(),await async function(e){try{const t=await fetch("/execute_confirmed_sql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e})});if(!t.ok){let e="HTTP error! status: "+t.status;try{const n=await t.json();e=n.content||n.detail||e}catch(e){}throw Error(e)}const n=await t.json();let s="";"info"===n.type?s=b(n.content):"error"===n.type?(s=b(n.content),n.ai_explanation&&(s+=b(n.ai_explanation))):"result"===n.type?(s+=`<p class="font-semibold">Query Executed:</p><pre><code class="language-sql">${E(n.query||"")}</code></pre>`,s+=I(n.columns,n.results),n.insights&&(s+=b(n.insights))):s=`<p>${E((n.content||"Received unexpected response format.")+"")}</p>`,w("assistant",s,n.type)}catch(e){w("assistant",`<p>Sorry, I encountered an error during the confirmed execution: ${E(e.message)}</p>`,"error")}}(e),t&&(t.innerHTML='<p class="text-sm text-gray-600 italic">The confirmed query execution has been processed. See result in the new message below.</p>',t.className="p-3 rounded-lg bg-gray-50 border border-gray-200 text-gray-500 max-w-3xl mr-auto prose prose-sm max-w-none shadow-sm"),j()&&P()}),o&&o.addEventListener("click",function(){const e=this.closest(".p-3.rounded-lg");e&&(e.className="p-3 rounded-lg bg-gray-100 text-gray-600 max-w-3xl mr-auto prose prose-sm max-w-none italic shadow",e.innerHTML="<p>Execution cancelled by user.</p>"),j()&&P()}),j()&&P(),T(!1)}(s.message,s.query);a=`<p>${E((s.content||"Received unexpected response format.")+"")}</p>`}w("assistant",a,s.type)}catch(e){w("assistant",`<p>Sorry, I encountered an error: ${E(e.message)}</p>`,"error")}finally{T(!1)}}(a),v&&C())}),o.addEventListener("click",()=>{const e=a.classList.contains("open"),t=document.getElementById("schema-db-icon"),n=document.getElementById("schema-up-icon"),s=document.getElementById("schema-text");if(t.classList.remove("schema-icon-animate-out","schema-icon-animate-in"),n.classList.remove("schema-icon-animate-out","schema-icon-animate-in"),t.style.opacity="",t.style.transform="",n.style.opacity="",n.style.transform="",e)a.classList.remove("open"),a.classList.add("closing"),s.textContent="View Schema",setTimeout(()=>{a.classList.remove("closing")},300),s.textContent="View Schema",n.classList.add("schema-icon-animate-out"),n.addEventListener("animationend",function(){n.classList.add("hidden"),n.classList.remove("schema-icon-animate-out"),t.classList.remove("hidden"),t.offsetWidth,t.classList.add("schema-icon-animate-in"),t.addEventListener("animationend",function(){t.classList.remove("schema-icon-animate-in")},{once:!0})},{once:!0});else{a.classList.add("open"),s.textContent="Hide Schema",t.classList.add("schema-icon-animate-out"),t.addEventListener("animationend",function(){t.classList.add("hidden"),t.classList.remove("schema-icon-animate-out"),n.classList.remove("hidden"),n.offsetWidth,n.classList.add("schema-icon-animate-in"),n.addEventListener("animationend",function(){n.classList.remove("schema-icon-animate-in")},{once:!0})},{once:!0});const e=i.innerHTML,o=e.trim(),c=o.startsWith("\x3c!--")||""===o,r=e.includes("Loading schema..."),l=e.includes("Failed to load schema")||e.includes("Error fetching schema")||e.includes("No databases or tables found, or unable to fetch schema")||e.includes("No databases or tables found.");(c||r||l)&&k()}}),c.addEventListener("click",()=>{k(!0)}),r.addEventListener("click",()=>{const e=document.getElementById("settings-icon");l.classList.contains("visible")?(l.classList.remove("visible"),e.classList.remove("settings-icon-rotate-cw"),e.classList.add("settings-icon-rotate-ccw")):(l.classList.add("visible"),e.classList.remove("settings-icon-rotate-ccw"),e.classList.add("settings-icon-rotate-cw"))}),d.addEventListener("click",()=>{l.classList.remove("visible")}),document.getElementById("config-save-btn").addEventListener("click",async()=>{const e={mysqlHost:document.getElementById("mysql-host").value||"localhost",mysqlUser:document.getElementById("mysql-user").value||"root",mysqlPassword:document.getElementById("mysql-password").value||"root",geminiApiKey:document.getElementById("gemini-api-key").value||""};await async function(e){const t=document.getElementById("config-save-btn"),n=document.getElementById("config-save-text"),s=document.getElementById("config-save-spinner");t.disabled=!0,n.classList.add("opacity-75"),s.classList.remove("hidden"),s.innerHTML=x("w-4 h-4 text-white");try{const t=await fetch("/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mysql_host:e.mysqlHost,mysql_user:e.mysqlUser,mysql_password:e.mysqlPassword,gemini_api_key:e.geminiApiKey})});if(!t.ok)throw Error("HTTP error! status: "+t.status);const n=await t.json();if("success"===n.status){const e=[];"success"!==n.mysql_connection&&e.push("MySQL connection warning: "+n.mysql_connection),"success"!==n.gemini_api&&e.push("Gemini API warning: "+n.gemini_api),e.length>0?H(`Configuration saved with warnings:\n${e.join("\n")}\n\nChanges have been applied and .env file updated.`,"warning"):H("Configuration successfully saved and applied! No restart required.","success"),k(!0),q()}else H("Configuration status: "+n.message,"info")}catch(e){H(`Error saving configuration: ${e.message}. Please try again.`,"error")}finally{t.disabled=!1,n.classList.remove("opacity-75"),s.classList.add("hidden"),s.innerHTML=""}}(e),l.classList.remove("visible")}),t.addEventListener("input",()=>{const e=t.value;if(v)M();else{if(e.startsWith("/run ")){const n=e.substring(5);return B(),void(t.value=n)}e.startsWith("/")?function(){const e=t.value;if(!e.startsWith("/"))return void M();const n=e.substring(1).toLowerCase(),s=["run"].filter(e=>e.startsWith(n));s.length>0?(f.innerHTML="",s.forEach(e=>{const t=document.createElement("div");t.textContent="/"+e,t.dataset.command="/"+e,t.addEventListener("click",()=>{B()}),f.appendChild(t)}),f.classList.remove("hidden")):M()}():M()}}),y.addEventListener("click",()=>{C()}),document.addEventListener("click",function(e){if(!f.classList.contains("hidden")){const n=f.contains(e.target),s=t.contains(e.target);n||s||M()}}),i.addEventListener("click",function(e){const t=e.target.closest(".schema-database-item");if(t){t.classList.toggle("expanded");const e=t.nextElementSibling;e&&e.classList.contains("database-content-wrapper")&&(e.style.maxHeight&&"0px"!==e.style.maxHeight?e.style.maxHeight="0px":e.style.maxHeight=e.scrollHeight+"px")}else{const t=e.target.closest(".schema-table-item");if(t){t.classList.toggle("expanded");const e=t.nextElementSibling;if(e&&e.classList.contains("schema-columns-list")){const n=t.closest(".database-content-wrapper");if(e.style.maxHeight&&"0px"!==e.style.maxHeight){const t=e.scrollHeight;e.style.maxHeight="0px",n&&"0px"!==n.style.maxHeight&&(n.style.maxHeight=parseInt(n.style.maxHeight)-t+"px")}else{const t=e.scrollHeight;e.style.maxHeight=t+"px",n&&"0px"!==n.style.maxHeight&&(n.style.maxHeight=parseInt(n.style.maxHeight)+t+"px")}}}}lucide.createIcons()}),S("mysql-password","Enter new password to update"),S("gemini-api-key","Enter new key to update"),lucide.createIcons(),document.addEventListener("DOMContentLoaded",()=>{q(),D(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches),document.querySelectorAll(".header-btn, #send-button, #refresh-schema-btn, #config-save-btn, #close-config-btn, #terminal-btn, #scroll-bottom-btn").forEach(e=>{e.classList.add("ripple-container"),e.addEventListener("click",N)});const e=document.getElementById("header-db-icon");e&&(e.classList.add("icon-rotate-onload"),e.addEventListener("animationend",()=>{e.classList.remove("icon-rotate-onload")},{once:!0})),$(),A()}),document.querySelectorAll(".toggle-password").forEach(e=>{e.addEventListener("click",function(){const e=this.dataset.target,t=document.getElementById(e);t&&("password"===t.type?(t.type="text",this.innerHTML='<i data-lucide="eye-off" class="h-4 w-4"></i>'):(t.type="password",this.innerHTML='<i data-lucide="eye" class="h-4 w-4"></i>'),lucide.createIcons())})}),m.addEventListener("click",()=>{!async function(){try{const t=await fetch("/reset_chat",{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("Server responded with status: "+t.status);const n=await t.json();if("success"!==n.status)throw Error(n.message||"Failed to reset chat on server.");e.innerHTML="",L=!0,u.classList.add("initial-state"),$(),H("New chat started.","success",3e3)}catch(e){H("Could not start new chat: "+e.message,"error")}}()});const _=document.getElementById("scroll-bottom-btn");function A(){_&&_.classList.toggle("hidden",j())}let O=null;function D(e){e?(document.documentElement.classList.add("dark"),h.innerHTML='<i data-lucide="sun"></i>'):(document.documentElement.classList.remove("dark"),h.innerHTML='<i data-lucide="moon"></i>'),lucide.createIcons()}function Q(){document.documentElement.style.setProperty("--app-height",window.innerHeight+"px")}e.addEventListener("scroll",()=>{O||(O=setTimeout(()=>{A(),O=null},100))}),_&&_.addEventListener("click",()=>{P(!0),A()}),p.addEventListener("click",e=>{!function(e,t){const n=document.createElement("span");n.className="theme-toggle-ripple";const s=e.clientX,a=e.clientY;n.style.left=s+"px",n.style.top=a+"px",n.style.backgroundColor=t?"#121212":"#ffffff";const i=2*Math.max(window.innerWidth,window.innerHeight);n.style.width=n.style.height=i+"px",n.style.marginLeft=`-${i/2}px`,n.style.marginTop=`-${i/2}px`,document.body.appendChild(n),setTimeout(()=>{D(t)},50),n.addEventListener("animationend",()=>{n.remove()})}(e,!document.documentElement.classList.contains("dark"))}),window.addEventListener("resize",Q),document.addEventListener("DOMContentLoaded",Q);